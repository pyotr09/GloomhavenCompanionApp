using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using Amazon.DynamoDBv2;
using Amazon.DynamoDBv2.Model;
using Gloom.Models.Scenario;
using Newtonsoft.Json;
using Xunit;
using Xunit.Abstractions;

namespace Gloom.Tests;

public class DbHandlerTests
{
    private readonly ITestOutputHelper _testOutputHelper;

    public DbHandlerTests(ITestOutputHelper testOutputHelper)
    {
        _testOutputHelper = testOutputHelper;
    }
    
    public async Task TryThings()
    {
        // FOR LOCAL DYNAMODB INSTANCE
        AmazonDynamoDBConfig config = new AmazonDynamoDBConfig();
        config.ServiceURL = "http://localhost:8000";
        
        AmazonDynamoDBClient client = new AmazonDynamoDBClient(config);
        await ListMyTables(client);
        
        
        string tableName = "GloomAppSessions";
        await GetTableInformation(tableName, client);
        
        // var updateRequest = new UpdateItemRequest
        // {
        //     TableName = tableName,
        //     Key = new Dictionary<string, AttributeValue>
        //     {
        //         {"Id", new AttributeValue {N = "21132599"}}
        //     },
        //     ExpressionAttributeNames = new Dictionary<string, string>()
        //     {
        //         {"#S", "Scenario"}
        //     },
        //     ExpressionAttributeValues = new Dictionary<string, AttributeValue>()
        //     {
        //         {":scenario", new AttributeValue {S = "{\"Level\":1,\"Name\":\"Black Barrow\",\"NumCharacters\":4,\"MonsterGroups\":[{\"$type\":\"Gloom.BusinessLogic.Model.Monsters.MonsterGrouping, Gloom.BusinessLogic\",\"BaseStatsList\":[{\"$type\":\"Gloom.BusinessLogic.Model.Monsters.BaseMonsterStats, Gloom.BusinessLogic\",\"BaseAttackFormula\":\"2\",\"Health\":5,\"BaseTarget\":1,\"BaseRange\":4,\"BaseMove\":2,\"IsFlying\":false,\"StatusesInflicted\":[],\"HasAdvantage\":false,\"BaseShield\":0,\"BaseRetaliate\":0,\"BaseRetaliateRange\":0,\"BasePierce\":0,\"DoAttackersGainDisadvantage\":false,\"Tier\":3},{\"$type\":\"Gloom.BusinessLogic.Model.Monsters.BaseMonsterStats, Gloom.BusinessLogic\",\"BaseAttackFormula\":\"3\",\"Health\":7,\"BaseTarget\":1,\"BaseRange\":5,\"BaseMove\":2,\"IsFlying\":false,\"StatusesInflicted\":[],\"HasAdvantage\":false,\"BaseShield\":0,\"BaseRetaliate\":0,\"BaseRetaliateRange\":0,\"BasePierce\":0,\"DoAttackersGainDisadvantage\":false,\"Tier\":2}],\"AbilityDeck\":{\"Cards\":[{\"Initiative\":16,\"Name\":\"gh-ma-ar-1\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +1\",\"NormalActionText\":\"Move 3\",\"EliteActionText\":\"Move 3\"},{\"BaseActionText\":\"Attack -1\",\"NormalActionText\":\"Attack 1\n - Range 4\",\"EliteActionText\":\"Attack 2\n - Range 5\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-1.png\"},{\"Initiative\":31,\"Name\":\"gh-ma-ar-2\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 2\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 2\n - Range 4\",\"EliteActionText\":\"Attack 3\n - Range 5\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-2.png\"},{\"Initiative\":32,\"Name\":\"gh-ma-ar-3\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 2\"},{\"BaseActionText\":\"Attack +1, Range -1\",\"NormalActionText\":\"Attack 3\n - Range 3\",\"EliteActionText\":\"Attack 4\n - Range 4\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-3.png\"},{\"Initiative\":44,\"Name\":\"gh-ma-ar-4\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -1\",\"NormalActionText\":\"Move 1\",\"EliteActionText\":\"Move 1\"},{\"BaseActionText\":\"Attack +1\",\"NormalActionText\":\"Attack 3\n - Range 4\",\"EliteActionText\":\"Attack 4\n - Range 5\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-4.png\"},{\"Initiative\":56,\"Name\":\"gh-ma-ar-5\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Attack -1, Target 2\",\"NormalActionText\":\"Attack 1\n - Range 4\n - Target 2\",\"EliteActionText\":\"Attack 2\n - Range 5\n - Target 2\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-5.png\"},{\"Initiative\":68,\"Name\":\"gh-ma-ar-6\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Attack +1, Range +1\",\"NormalActionText\":\"Attack 3\n - Range 5\",\"EliteActionText\":\"Attack 4\n - Range 6\"}],\"ShuffleAfter\":true,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-6.png\"},{\"Initiative\":14,\"Name\":\"gh-ma-ar-7\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -1\",\"NormalActionText\":\"Move 1\",\"EliteActionText\":\"Move 1\"},{\"BaseActionText\":\"Attack -1\",\"NormalActionText\":\"Attack 1\n - Range 4\",\"EliteActionText\":\"Attack 2\n - Range 5\"},{\"BaseActionText\":\"Create a 3 damage trap in an adjacent empty hex closest to an enemy\",\"NormalActionText\":\"Create a 3 damage trap in an adjacent empty hex closest to an enemy\",\"EliteActionText\":\"Create a 3 damage trap in an adjacent empty hex closest to an enemy\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-7.png\"},{\"Initiative\":29,\"Name\":\"gh-ma-ar-8\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 2\"},{\"BaseActionText\":\"Attack -1, Range +1, Immobilize\",\"NormalActionText\":\"Attack 1\n - Range 5\n - Immobilize\",\"EliteActionText\":\"Attack 2\n - Range 6\n - Immobilize\"}],\"ShuffleAfter\":true,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-8.png\"}],\"DrawPile\":[{\"Initiative\":68,\"Name\":\"gh-ma-ar-6\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Attack +1, Range +1\",\"NormalActionText\":\"Attack 3\n - Range 5\",\"EliteActionText\":\"Attack 4\n - Range 6\"}],\"ShuffleAfter\":true,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-6.png\"},{\"Initiative\":32,\"Name\":\"gh-ma-ar-3\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 2\"},{\"BaseActionText\":\"Attack +1, Range -1\",\"NormalActionText\":\"Attack 3\n - Range 3\",\"EliteActionText\":\"Attack 4\n - Range 4\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-3.png\"},{\"Initiative\":16,\"Name\":\"gh-ma-ar-1\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +1\",\"NormalActionText\":\"Move 3\",\"EliteActionText\":\"Move 3\"},{\"BaseActionText\":\"Attack -1\",\"NormalActionText\":\"Attack 1\n - Range 4\",\"EliteActionText\":\"Attack 2\n - Range 5\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-1.png\"},{\"Initiative\":31,\"Name\":\"gh-ma-ar-2\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 2\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 2\n - Range 4\",\"EliteActionText\":\"Attack 3\n - Range 5\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-2.png\"},{\"Initiative\":44,\"Name\":\"gh-ma-ar-4\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -1\",\"NormalActionText\":\"Move 1\",\"EliteActionText\":\"Move 1\"},{\"BaseActionText\":\"Attack +1\",\"NormalActionText\":\"Attack 3\n - Range 4\",\"EliteActionText\":\"Attack 4\n - Range 5\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-4.png\"},{\"Initiative\":56,\"Name\":\"gh-ma-ar-5\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Attack -1, Target 2\",\"NormalActionText\":\"Attack 1\n - Range 4\n - Target 2\",\"EliteActionText\":\"Attack 2\n - Range 5\n - Target 2\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-5.png\"},{\"Initiative\":29,\"Name\":\"gh-ma-ar-8\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 2\"},{\"BaseActionText\":\"Attack -1, Range +1, Immobilize\",\"NormalActionText\":\"Attack 1\n - Range 5\n - Immobilize\",\"EliteActionText\":\"Attack 2\n - Range 6\n - Immobilize\"}],\"ShuffleAfter\":true,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-8.png\"},{\"Initiative\":14,\"Name\":\"gh-ma-ar-7\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -1\",\"NormalActionText\":\"Move 1\",\"EliteActionText\":\"Move 1\"},{\"BaseActionText\":\"Attack -1\",\"NormalActionText\":\"Attack 1\n - Range 4\",\"EliteActionText\":\"Attack 2\n - Range 5\"},{\"BaseActionText\":\"Create a 3 damage trap in an adjacent empty hex closest to an enemy\",\"NormalActionText\":\"Create a 3 damage trap in an adjacent empty hex closest to an enemy\",\"EliteActionText\":\"Create a 3 damage trap in an adjacent empty hex closest to an enemy\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/archer/gh-ma-ar-7.png\"}],\"DiscardPile\":[]},\"Type\":\"Monster\",\"Count\":6,\"Initiative\":null,\"Name\":\"Bandit Archer\",\"Monsters\":[],\"ActiveAbilityCard\":null},{\"$type\":\"Gloom.BusinessLogic.Model.Monsters.MonsterGrouping, Gloom.BusinessLogic\",\"BaseStatsList\":[{\"$type\":\"Gloom.BusinessLogic.Model.Monsters.BaseMonsterStats, Gloom.BusinessLogic\",\"BaseAttackFormula\":\"2\",\"Health\":6,\"BaseTarget\":1,\"BaseRange\":0,\"BaseMove\":3,\"IsFlying\":false,\"StatusesInflicted\":[],\"HasAdvantage\":false,\"BaseShield\":0,\"BaseRetaliate\":0,\"BaseRetaliateRange\":0,\"BasePierce\":0,\"DoAttackersGainDisadvantage\":false,\"Tier\":3},{\"$type\":\"Gloom.BusinessLogic.Model.Monsters.BaseMonsterStats, Gloom.BusinessLogic\",\"BaseAttackFormula\":\"3\",\"Health\":9,\"BaseTarget\":1,\"BaseRange\":0,\"BaseMove\":2,\"IsFlying\":false,\"StatusesInflicted\":[],\"HasAdvantage\":false,\"BaseShield\":1,\"BaseRetaliate\":0,\"BaseRetaliateRange\":0,\"BasePierce\":0,\"DoAttackersGainDisadvantage\":false,\"Tier\":2}],\"AbilityDeck\":{\"Cards\":[{\"Initiative\":15,\"Name\":\"gh-ma-gu-1\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Shield 1\",\"NormalActionText\":\"Shield 1\",\"EliteActionText\":\"Shield 1\"},{\"BaseActionText\":\"Retaliate 2\",\"NormalActionText\":\"Retaliate 2\",\"EliteActionText\":\"Retaliate 2\"}],\"ShuffleAfter\":true,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-1.png\"},{\"Initiative\":30,\"Name\":\"gh-ma-gu-2\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +1\",\"NormalActionText\":\"Move 4\",\"EliteActionText\":\"Move 3\"},{\"BaseActionText\":\"Attack -1\",\"NormalActionText\":\"Attack 1\",\"EliteActionText\":\"Attack 2\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-2.png\"},{\"Initiative\":35,\"Name\":\"gh-ma-gu-3\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -1\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 1\"},{\"BaseActionText\":\"Attack +0, Range 2\",\"NormalActionText\":\"Attack 2\n - Range 2\",\"EliteActionText\":\"Attack 3\n - Range 2\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-3.png\"},{\"Initiative\":50,\"Name\":\"gh-ma-gu-4\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 3\",\"EliteActionText\":\"Move 2\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 2\",\"EliteActionText\":\"Attack 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-4.png\"},{\"Initiative\":50,\"Name\":\"gh-ma-gu-5\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 3\",\"EliteActionText\":\"Move 2\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 2\",\"EliteActionText\":\"Attack 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-5.png\"},{\"Initiative\":70,\"Name\":\"gh-ma-gu-6\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -1\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 1\"},{\"BaseActionText\":\"Attack +1\",\"NormalActionText\":\"Attack 3\",\"EliteActionText\":\"Attack 4\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-6.png\"},{\"Initiative\":55,\"Name\":\"gh-ma-gu-7\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -1\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 1\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 2\",\"EliteActionText\":\"Attack 3\"},{\"BaseActionText\":\"Strengthen, Self\",\"NormalActionText\":\"Strengthen\n - Self\",\"EliteActionText\":\"Strengthen\n - Self\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-7.png\"},{\"Initiative\":15,\"Name\":\"gh-ma-gu-8\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Shield 1\",\"NormalActionText\":\"Shield 1\",\"EliteActionText\":\"Shield 1\"},{\"BaseActionText\":\"Attack +0, Poison\",\"NormalActionText\":\"Attack 2\n - Poison\",\"EliteActionText\":\"Attack 3\n - Poison\"}],\"ShuffleAfter\":true,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-8.png\"}],\"DrawPile\":[{\"Initiative\":55,\"Name\":\"gh-ma-gu-7\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -1\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 1\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 2\",\"EliteActionText\":\"Attack 3\"},{\"BaseActionText\":\"Strengthen, Self\",\"NormalActionText\":\"Strengthen\n - Self\",\"EliteActionText\":\"Strengthen\n - Self\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-7.png\"},{\"Initiative\":50,\"Name\":\"gh-ma-gu-5\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 3\",\"EliteActionText\":\"Move 2\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 2\",\"EliteActionText\":\"Attack 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-5.png\"},{\"Initiative\":50,\"Name\":\"gh-ma-gu-4\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 3\",\"EliteActionText\":\"Move 2\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 2\",\"EliteActionText\":\"Attack 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-4.png\"},{\"Initiative\":15,\"Name\":\"gh-ma-gu-8\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Shield 1\",\"NormalActionText\":\"Shield 1\",\"EliteActionText\":\"Shield 1\"},{\"BaseActionText\":\"Attack +0, Poison\",\"NormalActionText\":\"Attack 2\n - Poison\",\"EliteActionText\":\"Attack 3\n - Poison\"}],\"ShuffleAfter\":true,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-8.png\"},{\"Initiative\":70,\"Name\":\"gh-ma-gu-6\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -1\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 1\"},{\"BaseActionText\":\"Attack +1\",\"NormalActionText\":\"Attack 3\",\"EliteActionText\":\"Attack 4\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-6.png\"},{\"Initiative\":30,\"Name\":\"gh-ma-gu-2\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +1\",\"NormalActionText\":\"Move 4\",\"EliteActionText\":\"Move 3\"},{\"BaseActionText\":\"Attack -1\",\"NormalActionText\":\"Attack 1\",\"EliteActionText\":\"Attack 2\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-2.png\"},{\"Initiative\":15,\"Name\":\"gh-ma-gu-1\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Shield 1\",\"NormalActionText\":\"Shield 1\",\"EliteActionText\":\"Shield 1\"},{\"BaseActionText\":\"Retaliate 2\",\"NormalActionText\":\"Retaliate 2\",\"EliteActionText\":\"Retaliate 2\"}],\"ShuffleAfter\":true,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-1.png\"},{\"Initiative\":35,\"Name\":\"gh-ma-gu-3\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -1\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 1\"},{\"BaseActionText\":\"Attack +0, Range 2\",\"NormalActionText\":\"Attack 2\n - Range 2\",\"EliteActionText\":\"Attack 3\n - Range 2\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/guard/gh-ma-gu-3.png\"}],\"DiscardPile\":[]},\"Type\":\"Monster\",\"Count\":6,\"Initiative\":null,\"Name\":\"Bandit Guard\",\"Monsters\":[],\"ActiveAbilityCard\":null},{\"$type\":\"Gloom.BusinessLogic.Model.Monsters.MonsterGrouping, Gloom.BusinessLogic\",\"BaseStatsList\":[{\"$type\":\"Gloom.BusinessLogic.Model.Monsters.BaseMonsterStats, Gloom.BusinessLogic\",\"BaseAttackFormula\":\"1\",\"Health\":5,\"BaseTarget\":2,\"BaseRange\":0,\"BaseMove\":3,\"IsFlying\":false,\"StatusesInflicted\":[],\"HasAdvantage\":false,\"BaseShield\":1,\"BaseRetaliate\":0,\"BaseRetaliateRange\":0,\"BasePierce\":0,\"DoAttackersGainDisadvantage\":false,\"Tier\":3},{\"$type\":\"Gloom.BusinessLogic.Model.Monsters.BaseMonsterStats, Gloom.BusinessLogic\",\"BaseAttackFormula\":\"2\",\"Health\":6,\"BaseTarget\":3,\"BaseRange\":0,\"BaseMove\":4,\"IsFlying\":false,\"StatusesInflicted\":[],\"HasAdvantage\":false,\"BaseShield\":1,\"BaseRetaliate\":0,\"BaseRetaliateRange\":0,\"BasePierce\":0,\"DoAttackersGainDisadvantage\":false,\"Tier\":2}],\"AbilityDeck\":{\"Cards\":[{\"Initiative\":64,\"Name\":\"gh-ma-lb-1\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -1\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 3\"},{\"BaseActionText\":\"Attack +1\",\"NormalActionText\":\"Attack 2\n - Target 2\",\"EliteActionText\":\"Attack 3\n - Target 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-1.png\"},{\"Initiative\":20,\"Name\":\"gh-ma-lb-2\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -2\",\"NormalActionText\":\"Move 1\",\"EliteActionText\":\"Move 2\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 1\n - Target 2\",\"EliteActionText\":\"Attack 2\n - Target 3\"},{\"BaseActionText\":\"Heal 2, Self\",\"NormalActionText\":\"Heal 2\n - Self\",\"EliteActionText\":\"Heal 2\n - Self\"}],\"ShuffleAfter\":true,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-2.png\"},{\"Initiative\":25,\"Name\":\"gh-ma-lb-3\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +1\",\"NormalActionText\":\"Move 4\",\"EliteActionText\":\"Move 5\"},{\"BaseActionText\":\"Attack -1\",\"NormalActionText\":\"Attack 0\n - Target 2\",\"EliteActionText\":\"Attack 1\n - Target 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-3.png\"},{\"Initiative\":45,\"Name\":\"gh-ma-lb-4\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 3\",\"EliteActionText\":\"Move 4\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 1\n - Target 2\",\"EliteActionText\":\"Attack 2\n - Target 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-4.png\"},{\"Initiative\":45,\"Name\":\"gh-ma-lb-5\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 3\",\"EliteActionText\":\"Move 4\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 1\n - Target 2\",\"EliteActionText\":\"Attack 2\n - Target 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-5.png\"},{\"Initiative\":81,\"Name\":\"gh-ma-lb-6\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Attack +1\",\"NormalActionText\":\"Attack 2\n - Target 2\",\"EliteActionText\":\"Attack 3\n - Target 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-6.png\"},{\"Initiative\":74,\"Name\":\"gh-ma-lb-7\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 3\",\"EliteActionText\":\"Move 4\"},{\"BaseActionText\":\"Attack +0, Target one enemy with all attacks\",\"NormalActionText\":\"Attack 1\n - Target one enemy with all attacks\",\"EliteActionText\":\"Attack 2\n - Target one enemy with all attacks\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-7.png\"},{\"Initiative\":12,\"Name\":\"gh-ma-lb-8\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Shield 1\",\"NormalActionText\":\"Shield 1\",\"EliteActionText\":\"Shield 1\"},{\"BaseActionText\":\"Heal 2, Self\",\"NormalActionText\":\"Heal 2\n - Self\",\"EliteActionText\":\"Heal 2\n - Self\"}],\"ShuffleAfter\":true,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-8.png\"}],\"DrawPile\":[{\"Initiative\":74,\"Name\":\"gh-ma-lb-7\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 3\",\"EliteActionText\":\"Move 4\"},{\"BaseActionText\":\"Attack +0, Target one enemy with all attacks\",\"NormalActionText\":\"Attack 1\n - Target one enemy with all attacks\",\"EliteActionText\":\"Attack 2\n - Target one enemy with all attacks\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-7.png\"},{\"Initiative\":45,\"Name\":\"gh-ma-lb-5\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 3\",\"EliteActionText\":\"Move 4\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 1\n - Target 2\",\"EliteActionText\":\"Attack 2\n - Target 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-5.png\"},{\"Initiative\":20,\"Name\":\"gh-ma-lb-2\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -2\",\"NormalActionText\":\"Move 1\",\"EliteActionText\":\"Move 2\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 1\n - Target 2\",\"EliteActionText\":\"Attack 2\n - Target 3\"},{\"BaseActionText\":\"Heal 2, Self\",\"NormalActionText\":\"Heal 2\n - Self\",\"EliteActionText\":\"Heal 2\n - Self\"}],\"ShuffleAfter\":true,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-2.png\"},{\"Initiative\":25,\"Name\":\"gh-ma-lb-3\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +1\",\"NormalActionText\":\"Move 4\",\"EliteActionText\":\"Move 5\"},{\"BaseActionText\":\"Attack -1\",\"NormalActionText\":\"Attack 0\n - Target 2\",\"EliteActionText\":\"Attack 1\n - Target 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-3.png\"},{\"Initiative\":64,\"Name\":\"gh-ma-lb-1\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move -1\",\"NormalActionText\":\"Move 2\",\"EliteActionText\":\"Move 3\"},{\"BaseActionText\":\"Attack +1\",\"NormalActionText\":\"Attack 2\n - Target 2\",\"EliteActionText\":\"Attack 3\n - Target 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-1.png\"},{\"Initiative\":81,\"Name\":\"gh-ma-lb-6\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Attack +1\",\"NormalActionText\":\"Attack 2\n - Target 2\",\"EliteActionText\":\"Attack 3\n - Target 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-6.png\"},{\"Initiative\":45,\"Name\":\"gh-ma-lb-4\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Move +0\",\"NormalActionText\":\"Move 3\",\"EliteActionText\":\"Move 4\"},{\"BaseActionText\":\"Attack +0\",\"NormalActionText\":\"Attack 1\n - Target 2\",\"EliteActionText\":\"Attack 2\n - Target 3\"}],\"ShuffleAfter\":false,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-4.png\"},{\"Initiative\":12,\"Name\":\"gh-ma-lb-8\",\"Expansion\":\"Gloomhaven\",\"Actions\":[{\"BaseActionText\":\"Shield 1\",\"NormalActionText\":\"Shield 1\",\"EliteActionText\":\"Shield 1\"},{\"BaseActionText\":\"Heal 2, Self\",\"NormalActionText\":\"Heal 2\n - Self\",\"EliteActionText\":\"Heal 2\n - Self\"}],\"ShuffleAfter\":true,\"ImagePath\":\"monster-ability-cards/gloomhaven/living-bones/gh-ma-lb-8.png\"}],\"DiscardPile\":[]},\"Type\":\"Monster\",\"Count\":10,\"Initiative\":null,\"Name\":\"Living Bones\",\"Monsters\":[],\"ActiveAbilityCard\":null}],\"IsBetweenRounds\":true}"}}
        //     },
        //     UpdateExpression = "SET #S = :scenario",
        //     ReturnValues = ReturnValue.ALL_NEW
        // };
        // var updateItemResponse = await client.UpdateItemAsync(updateRequest);
        
       
        var getRequest = new GetItemRequest
        {
            TableName = tableName,
            Key = new Dictionary<string, AttributeValue> {{"Id", new AttributeValue {N = "21132671"}}},
            ProjectionExpression = "Id, Scenario"
        };
        var response = await client.GetItemAsync(getRequest);
        var scenarioString = response.Item["Scenario"].S;
        var scen = JsonConvert.DeserializeObject<Scenario>(scenarioString, new JsonSerializerSettings
        {
            TypeNameHandling = TypeNameHandling.Auto
        });
        
        _testOutputHelper.WriteLine(scenarioString);
    }

    [Fact]
    public string GenerateId()
    {
        var ticks = DateTime.Now.Ticks % 65535;
        ushort ts = Convert.ToUInt16(ticks);
        var randid = new Random().Next(512);

        var result = ts * 512 + randid;
        _testOutputHelper.WriteLine(result.ToString());
        return result.ToString();
    }
    
    private async Task ListMyTables(AmazonDynamoDBClient client)
    {
        _testOutputHelper.WriteLine("\n*** listing tables ***");
        string lastTableNameEvaluated = null;
        do
        {
            var request = new ListTablesRequest
            {
                Limit = 2,
                ExclusiveStartTableName = lastTableNameEvaluated
            };

            var response =  await client.ListTablesAsync(request);
            foreach (string name in response.TableNames)
                _testOutputHelper.WriteLine(name);

            lastTableNameEvaluated = response.LastEvaluatedTableName;
        } while (lastTableNameEvaluated != null);
    }
    
    private async Task GetTableInformation(string tableName, AmazonDynamoDBClient client)
    {
        _testOutputHelper.WriteLine("\n*** Retrieving table information ***");
        var request = new DescribeTableRequest
        {
            TableName = tableName
        };

        var response = await client.DescribeTableAsync(request);

        TableDescription description = response.Table;
        _testOutputHelper.WriteLine("Name: {0}", description.TableName);
        _testOutputHelper.WriteLine("# of items: {0}", description.ItemCount);
        _testOutputHelper.WriteLine("Provision Throughput (reads/sec): {0}",
            description.ProvisionedThroughput.ReadCapacityUnits);
        _testOutputHelper.WriteLine("Provision Throughput (writes/sec): {0}",
            description.ProvisionedThroughput.WriteCapacityUnits);
    }
}